---
import Code from "./icons/Code.astro";
---

<article
  id="proyectos"
  class="w-full mx-auto max-w-[60ch] px-6 content-center py-20"
>
  <div class="flex flex-row pb-5 gap-x-3">
    <Code class="size-10" />
    <h2
      id="proyectos-title"
      class="text-3xl font-bold gap-x-3 pb-5 inline-flex items-center dark:text-white"
    >
    </h2>
  </div>
  <ol id="proyectos-list" class="w-full mx-auto max-w-[60ch] content-center container"></ol>
</article>
<script>
  import { techIcons } from "../utils/icons.js";
  
  const data = (
    await import(`../utils/data.json`, {
      assert: { type: "json" },
    })
  ).default;

  // Exponer funciÃ³n globalmente para uso en innerHTML
  window.getTechIcon = (techName) => techIcons[techName] || "";

  async function render() {
    let title = document.querySelector("#proyectos-title");
    const lang = document.documentElement.lang.toUpperCase();
    title.textContent = data[lang].titles.projects;
    let proyectos = data[lang].projects;
    changeInfo(proyectos);
  }

  function changeInfo(projects) {
    const ol = document.querySelectorAll("#proyectos-list");
    
    ol.forEach((o) => {
      o.innerHTML = "";
    });

    projects.forEach((proyecto) => {
      const li = document.createElement("li");
      li.className = "ml-7 mb-10 ms-4 text-pretty";
      li.innerHTML = `
        <h3 class="text-lg font-semibold text-cyan-500">${proyecto.name}</h3>
        <p class="mb-4 text-base font-normal dark:text-white">
          ${proyecto.description}
        </p>
        <ul class="flex flex-row flex-wrap gap-x-4 gap-y-2 mb-4">
          ${proyecto.technologies
            .map((tech) => {
              const icon = window.getTechIcon(tech);
              return `
                <li>
                  <span class="flex gap-x-2 text-black px-1">
                    ${icon}
                    <span class="dark:text-white text-white">${tech}</span>
                  </span>
                </li>
              `;
            })
            .join("")}
        </ul>
        <a
          href="${proyecto.preview}"
          class="inline-flex items-center justify-center gap-2 px-3 py-2 space-x-2 text-base transition group max-w-fit rounded-xl text-white dark:bg-gray-100 border dark:border-gray-300  bg-gray-800 border-gray-600 dark:text-gray-700 dark:hover:text-black text-md dark:hover:bg-cyan-500 hover:bg-cyan-500  focus:outline-none focus-visible:outline-none focus-visible:ring focus-visible:ring-white focus-visible:ring-offset-2 active:bg-black"
          target="_blank"
        >
          ${window.getTechIcon("Preview")}
          Preview
        </a>
        <a
          href="${proyecto.github}"
          class="inline-flex items-center justify-center gap-2 px-3 py-2 space-x-2 text-base   text-md group max-w-fit rounded-xl text-white dark:bg-gray-100 border dark:border-gray-300  bg-gray-800 border-gray-600 dark:text-gray-700 dark:hover:text-black text-md dark:hover:bg-cyan-500 hover:bg-cyan-500  focus:outline-none focus-visible:outline-none focus-visible:ring focus-visible:ring-white focus-visible:ring-offset-2 active:bg-black"
          target="_blank"
        >
          ${window.getTechIcon("GitHub")}
          Github
        </a>
      `;
      ol.forEach((o) => {
        o.appendChild(li);
      });
    });
  }

  render();
  window.addEventListener("language-change", render);
</script>
